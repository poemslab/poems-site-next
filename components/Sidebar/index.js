import styles from './sidebar.module.scss'
import Link from 'next/link'
import { connect } from 'react-redux'
import { setLogOut } from '../../store/actions/action'
import { useRouter } from 'next/router'
import { useEffect, useRef, useState } from 'react'
import { FontAwesomeIcon } from '@fortawesome/react-fontawesome'
import { faBars } from '@fortawesome/free-solid-svg-icons'

function Sidebar({ logged, setLogOut }) {
  const router = useRouter()

  const [open, setOpen] = useState(true)
  const [width, setWidth] = useState(0)
  const sidebarRef = useRef(null)
  useEffect(() => {
    resize()
    function handleClickOutside(event) {
      if (sidebarRef.current && !sidebarRef.current.contains(event.target)) {
        if (window.innerWidth < 1050 && open) {
          setOpen(false)
        }
      }
    }

    function resize() {
      setWidth(window.innerWidth)
      if (window.innerWidth > 1050) {
        setOpen(true)
      } else {
        setOpen(false)
      }
    }
    document.addEventListener('mousedown', handleClickOutside)
    window.addEventListener('resize', resize)
    return () => {
      document.removeEventListener('mousedown', handleClickOutside)
      window.removeEventListener('resize', resize)
    }
  }, [])

  function logOut() {
    setLogOut()
    router.push('/')
  }

  return (
    <div>
      {
        open ?
          <div className={styles.sidebar} ref={sidebarRef}>
            <Link href='/'>
              <a>
                <svg width="126" height="29" viewBox="0 0 126 29" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M44.5244 16.2451V21H42.3008V8.20312H47.1963C48.626 8.20312 49.7598 8.5752 50.5977 9.31934C51.4414 10.0635 51.8633 11.0479 51.8633 12.2725C51.8633 13.5264 51.4502 14.502 50.624 15.1992C49.8037 15.8965 48.6523 16.2451 47.1699 16.2451H44.5244ZM44.5244 14.4609H47.1963C47.9873 14.4609 48.5908 14.2764 49.0068 13.9072C49.4229 13.5322 49.6309 12.9932 49.6309 12.29C49.6309 11.5986 49.4199 11.0479 48.998 10.6377C48.5762 10.2217 47.9961 10.0078 47.2578 9.99609H44.5244V14.4609ZM64.0273 14.9355C64.0273 16.1895 63.8105 17.291 63.377 18.2402C62.9434 19.1836 62.3223 19.9102 61.5137 20.4199C60.7109 20.9238 59.7852 21.1758 58.7363 21.1758C57.6992 21.1758 56.7734 20.9238 55.959 20.4199C55.1504 19.9102 54.5234 19.1865 54.0781 18.249C53.6387 17.3115 53.416 16.2305 53.4102 15.0059V14.2852C53.4102 13.0371 53.6299 11.9355 54.0693 10.9805C54.5146 10.0254 55.1387 9.2959 55.9414 8.79199C56.75 8.28223 57.6758 8.02734 58.7188 8.02734C59.7617 8.02734 60.6846 8.2793 61.4873 8.7832C62.2959 9.28125 62.9199 10.002 63.3594 10.9453C63.7988 11.8828 64.0215 12.9756 64.0273 14.2236V14.9355ZM61.8037 14.2676C61.8037 12.8496 61.5342 11.7627 60.9951 11.0068C60.4619 10.251 59.7031 9.87305 58.7188 9.87305C57.7578 9.87305 57.0049 10.251 56.46 11.0068C55.9209 11.7568 55.6455 12.8203 55.6338 14.1973V14.9355C55.6338 16.3418 55.9062 17.4287 56.4512 18.1963C57.002 18.9639 57.7637 19.3477 58.7363 19.3477C59.7207 19.3477 60.4766 18.9727 61.0039 18.2227C61.5371 17.4727 61.8037 16.377 61.8037 14.9355V14.2676ZM73.7217 15.2871H68.4658V19.2246H74.6094V21H66.2422V8.20312H74.5479V9.99609H68.4658V13.5293H73.7217V15.2871ZM79.3027 8.20312L82.9941 18.0117L86.6768 8.20312H89.5508V21H87.3359V16.7812L87.5557 11.1387L83.7764 21H82.1855L78.415 11.1475L78.6348 16.7812V21H76.4199V8.20312H79.3027ZM98.876 17.7041C98.876 17.1416 98.6768 16.708 98.2783 16.4033C97.8857 16.0986 97.1738 15.791 96.1426 15.4805C95.1113 15.1699 94.291 14.8242 93.6816 14.4434C92.5156 13.7109 91.9326 12.7559 91.9326 11.5781C91.9326 10.5469 92.3516 9.69727 93.1895 9.0293C94.0332 8.36133 95.126 8.02734 96.4678 8.02734C97.3584 8.02734 98.1523 8.19141 98.8496 8.51953C99.5469 8.84766 100.095 9.31641 100.493 9.92578C100.892 10.5293 101.091 11.2002 101.091 11.9385H98.876C98.876 11.2705 98.665 10.749 98.2432 10.374C97.8271 9.99316 97.2295 9.80273 96.4502 9.80273C95.7236 9.80273 95.1582 9.95801 94.7539 10.2686C94.3555 10.5791 94.1562 11.0127 94.1562 11.5693C94.1562 12.0381 94.373 12.4307 94.8066 12.7471C95.2402 13.0576 95.9551 13.3623 96.9512 13.6611C97.9473 13.9541 98.7471 14.291 99.3506 14.6719C99.9541 15.0469 100.396 15.4805 100.678 15.9727C100.959 16.459 101.1 17.0303 101.1 17.6865C101.1 18.7529 100.689 19.6025 99.8691 20.2354C99.0547 20.8623 97.9473 21.1758 96.5469 21.1758C95.6211 21.1758 94.7686 21.0059 93.9893 20.666C93.2158 20.3203 92.6123 19.8457 92.1787 19.2422C91.751 18.6387 91.5371 17.9355 91.5371 17.1328H93.7607C93.7607 17.8594 94.001 18.4219 94.4814 18.8203C94.9619 19.2188 95.6504 19.418 96.5469 19.418C97.3203 19.418 97.9004 19.2627 98.2871 18.9521C98.6797 18.6357 98.876 18.2197 98.876 17.7041ZM104.295 19.7178H108.491V21H102.689V11.7578H104.295V19.7178ZM115.023 18.8481H111.443L110.694 21H109.024L112.516 11.7578H113.957L117.454 21H115.778L115.023 18.8481ZM111.894 17.5532H114.572L113.233 13.7192L111.894 17.5532ZM118.508 21V11.7578H121.675C122.721 11.7578 123.516 11.9673 124.062 12.3862C124.608 12.8052 124.881 13.4294 124.881 14.2588C124.881 14.682 124.767 15.0628 124.538 15.4014C124.31 15.7399 123.975 16.0023 123.535 16.1885C124.035 16.3239 124.42 16.5799 124.69 16.9565C124.965 17.3289 125.103 17.7775 125.103 18.3022C125.103 19.1698 124.824 19.8363 124.265 20.3018C123.711 20.7673 122.915 21 121.878 21H118.508ZM120.114 16.8296V19.7178H121.897C122.401 19.7178 122.795 19.5929 123.078 19.3433C123.362 19.0936 123.503 18.7466 123.503 18.3022C123.503 17.3416 123.013 16.8507 122.031 16.8296H120.114ZM120.114 15.6489H121.688C122.187 15.6489 122.577 15.5368 122.856 15.3125C123.139 15.084 123.281 14.7624 123.281 14.3477C123.281 13.8906 123.15 13.5605 122.888 13.3574C122.63 13.1543 122.225 13.0527 121.675 13.0527H120.114V15.6489Z" fill="#EE9441" />
                  <path d="M14.5 0C10.6544 0 6.96623 1.52767 4.24695 4.24695C1.52767 6.96623 0 10.6544 0 14.5C0 18.3456 1.52767 22.0338 4.24695 24.753C6.96623 27.4723 10.6544 29 14.5 29C18.3456 29 22.0338 27.4723 24.753 24.753C27.4723 22.0338 29 18.3456 29 14.5C29 10.6544 27.4723 6.96623 24.753 4.24695C22.0338 1.52767 18.3456 0 14.5 0V0ZM1.78833 15.5956H5.83222C5.89667 17.0617 6.10128 18.5181 6.44444 19.9456H2.96444C2.3155 18.5775 1.91716 17.1042 1.78833 15.5956ZM15.5956 6.89556V1.91722C17.1482 2.50725 18.4239 3.65662 19.1722 5.13944C19.5025 5.6985 19.7941 6.28011 20.0422 6.87944L15.5956 6.89556ZM20.7833 9.07056C21.1571 10.4932 21.3794 11.9512 21.4439 13.4206H15.5956V9.07056H20.7833ZM13.4044 1.91722V6.89556H8.95778C9.20631 6.29573 9.49704 5.71428 9.82778 5.15556C10.5729 3.66665 11.8491 2.51118 13.4044 1.91722ZM13.4044 9.07056V13.4206H7.57222C7.63667 11.9512 7.859 10.4932 8.23278 9.07056H13.4044ZM5.83222 13.4044H1.78833C1.91716 11.8958 2.3155 10.4225 2.96444 9.05444H6.44444C6.10062 10.4813 5.89559 11.9381 5.83222 13.4044ZM7.57222 15.5956H13.4044V19.9456H8.23278C7.85906 18.5231 7.63763 17.0649 7.57222 15.5956ZM13.4206 22.04V27.0183C11.868 26.4283 10.5922 25.2789 9.84389 23.7961C9.51315 23.2374 9.22242 22.6559 8.97389 22.0561L13.4206 22.04ZM15.5956 27.0183V22.1206H20.0422C19.7937 22.7204 19.503 23.3018 19.1722 23.8606C18.4239 25.3434 17.1482 26.4928 15.5956 27.0828V27.0183ZM15.5956 19.865V15.515H21.4278C21.3624 16.9843 21.1409 18.4425 20.7672 19.865H15.5956ZM23.1839 15.515H27.2278C27.099 17.0237 26.7006 18.497 26.0517 19.865H22.5556C22.8939 18.4633 23.0985 17.0343 23.1678 15.5956L23.1839 15.515ZM23.1839 13.34C23.1101 11.9002 22.8997 10.4706 22.5556 9.07056H26.0356C26.6848 10.44 27.0828 11.9126 27.2117 13.4206L23.1839 13.34ZM24.795 6.89556H21.9111C21.3893 5.42993 20.633 4.05875 19.6717 2.83556C21.6765 3.73549 23.4179 5.13308 24.7306 6.89556H24.795ZM9.32833 2.83556C8.36701 4.05875 7.61069 5.42993 7.08889 6.89556H4.26944C5.58205 5.13308 7.3235 3.73549 9.32833 2.83556ZM4.25333 22.1689H7.08889C7.61069 23.6345 8.36701 25.0057 9.32833 26.2289C7.31795 25.3154 5.57597 23.9007 4.26944 22.1206L4.25333 22.1689ZM19.6556 26.2289C20.6169 25.0057 21.3732 23.6345 21.895 22.1689H24.7306C23.4099 23.9078 21.6692 25.2826 19.6717 26.1644L19.6556 26.2289Z" fill="#EE9441" />
                </svg>
              </a>
            </Link>
            <p>
              Главное меню
            </p>
            <ul>
              <li>
                <Link href='/' >
                  <a>
                    Главная
                  </a>
                </Link>
              </li>
              <li>
                <Link href='/categories' >
                  <a>
                    Категории
                  </a>
                </Link>
              </li>
              <li>
                <a>Modal</a>
              </li>
              {logged ?
                <li>
                  <Link href='/createpoema' >
                    <a>
                      Добавить стих
                    </a>
                  </Link>
                </li> : null}
              <div className={styles.bottom}>
                {logged ?
                  <a onClick={logOut}>
                    Выйти
                  </a>
                  : <Link href='/login' >
                    <a>
                      Войти
                    </a>
                  </Link>}
              </div>
            </ul>
          </div> : null
      }
      {
        width < 1050 ?
          <div className={styles.mobile}>
            <FontAwesomeIcon onClick={() => setOpen(true)} icon={faBars} size='2x' color='#000' />
          </div>
          : null
      }
    </div>
  )
}

const mapStateToProps = (state) => ({
  logged: state.loged,
  user: state.user
})

const mapDispatchToProps = (dispatch) => {
  return {
    setLogOut: () => dispatch(setLogOut())
  }
}

export default connect(mapStateToProps, mapDispatchToProps)(Sidebar)